## アプリケーション名
***
MapInfo

## アプリケーション概要
***
子育て世代のユーザー同士でMap上に公園の情報を共有し合うことができる

## URL
***
https://mapinfo-6239.herokuapp.com/

## テスト用アカウント
***
* Basic認証パスワード：mapinfo1234
* Basic認証ID：user

## 利用方法
***
### 公園情報の投稿
1. トップページのMap上で登録したい位置を指定する
2. 情報を登録するボタンから、公園の情報（公園名、ブランコの有無、すべり台の有無、砂場の有無、水道の有無、自動販売機の有無、駐輪場の有無、駐車場の有無、その他の情報）を入力し登録する

### 公園情報の確認
1. トップページのMap上に登録されているマーカーをクリックする
2. ウィンドウが表示されて、詳細ボタンから公園情報の詳細に移動
3. 編集ボタンから情報の編集、削除ボタンで情報の削除を行える

## アプリケーションを作成した背景
***
子育てをする上で、公園を利用する機会は多く少しの時間でも子供を遊ばせるために利用をしているが、
「たまには違う公園で子供を遊ばせてあげたい」
「買い物や保育園の送迎の途中で遊ばせたい」
「遠出をした際に少し子供を遊ばせたい」
そう思ったときに意外と家から少し離れるとどこに公園があるかがわからないということがあった。
私自身、3歳の子供がおり良く公園を利用しているので、近い年代の子供がいる家庭では同様の課題を感じているのではと考えた。
そこで、自分が知っている近所の公園の情報を共有しあえるアプリケーションを作成することにした。

## 洗い出した要件
***
### 【投稿機能】
目的：公園の情報を投稿する
* フォームから投稿内容を入力できる。登録ボタンから投稿ができる。
* 公園情報のタイトル、ブランコの有無、すべり台の有無、砂場の有無、水道の有無、自動販売機の有無、駐輪場の有無、
駐車場の有無を必須項目として入力できる。
* 任意として、その他の情報を入力することができる
* ヘッダーとページ内にトップページへのリンクがある

### 【一覧機能】
目的：投稿された公園情報を地図上に表示する
* 地図上をクリックすると指定の位置にマーカーを立てることができる
* ページ内に情報を登録するボタンがある（位置を指定しないとエラーとなりメッセージを表示する）
* 既に登録されている位置にはマーカーが立っていて、クリックすると情報ウィンドウが開く

### 【詳細機能】
目的：公園情報の詳細を表示する
* 公園の名前、ブランコの有無、すべり台の有無、砂場の有無、水道の有無、自動販売機の有無、駐輪場の有無、駐車場の有無、その他の情報が確認できる
* 編集ボタンが表示される
* 削除ボタンが表示される
* ヘッダーとページ内にトップページへのリンクがある

### 【編集機能】
目的：投稿されている公園情報を編集する
* 詳細ページから編集ボタンをクリックすると、編集フォームが表示される
* 何も変更せずに登録した場合も、投稿内容が消えることはない
* 位置情報以外の全ての情報を編集することができる。
* ヘッダーにトップページへのリンクがある

### 【削除機能】
目的：投稿されている公園情報を削除する
* 詳細ページから削除ボタンをクリックすると、公園情報が削除される
* 削除後は、トップページへリダイレクトされる

## 実装した機能についての画像やGIFおよびその説明
***
### 公園情報を登録する
①Map上で位置を指定して、画面左上の「情報を登録するボタン」をクリックする

[![Image from Gyazo](https://i.gyazo.com/fec477cf1b28f9e082b4fc5d645c0b19.gif)](https://gyazo.com/fec477cf1b28f9e082b4fc5d645c0b19)

②公園名と情報を入力して「情報を登録」ボタンをクリックすると情報が登録される。
「マップへ戻る」をクリックしてMapに戻ると登録した位置にマーカーが設置されている。

[![Image from Gyazo](https://i.gyazo.com/6630e4d170031a2550760b917f33549b.gif)](https://gyazo.com/6630e4d170031a2550760b917f33549b)

### 公園情報の編集
①Map上のマーカーをクリックして、情報ウィンドウを開き「詳細」をクリック

[![Image from Gyazo](https://i.gyazo.com/138990f08c086df4d51d344cc576859d.gif)](https://gyazo.com/138990f08c086df4d51d344cc576859d)

②画面左下の「編集」をクリックして、情報を編集後に「情報を登録」をクリックする

[![Image from Gyazo](https://i.gyazo.com/f0b01add25af5e97208e460f519efb35.gif)](https://gyazo.com/f0b01add25af5e97208e460f519efb35)

③「マップに戻る」をクリックして、情報ウィンドウを開くと内容が編集されている
[![Image from Gyazo](https://i.gyazo.com/2526b377aba18fb97ba5b00fc3f49a7d.gif)](https://gyazo.com/2526b377aba18fb97ba5b00fc3f49a7d)

### 公園情報の削除
①Map上のマーカーをクリックして、情報ウィンドウを開き「詳細」をクリック
②「削除」ボタンをクリックすると、トップページにリダイレクトし情報が消えている

[![Image from Gyazo](https://i.gyazo.com/2974abaa6ae34fa8bd0e60ccf9441654.gif)](https://gyazo.com/2974abaa6ae34fa8bd0e60ccf9441654)

### ※Map上にマーカーが表示されない場合
本番環境で動作させた際に、読み込みがうまくいかずマーカーがページ遷移後に表示されない場合があります。<br>その際は、スーパーリロードをしていただくと正常に読み込みをし表示することが出来ます。

## 実装予定の機能
***
画像投稿機能、コメント機能、現在地の表示機能を実装予定
また、本番環境での挙動が芳しくないためversion2の作成も検討

## データベース設計
***
[![Image from Gyazo](https://i.gyazo.com/de4db556d2d4811661adf1abe516ce46.png)](https://gyazo.com/de4db556d2d4811661adf1abe516ce46)

## 画面遷移図
***
[![Image from Gyazo](https://i.gyazo.com/e1b74b6c3839cc31fb45ebd88dd95a24.png)](https://gyazo.com/e1b74b6c3839cc31fb45ebd88dd95a24)

## 開発環境
***
* フロントエンド => Vue.js
* バックエンド => Django REST framework
* インフラ => heroku
* テキストエディタ => Visual Studio Code

## ローカルでの動作方法
***


## 工夫したポイント
***
### 【ページ遷移後のMapの表示位置】
ページ遷移後にMapの画面に戻ると常に初期表示の位置にMapが戻ってしまっていたので、以下のような設定を試みた。
* Map上で詳細ページへ遷移後に、再びMapに戻った際に選択した公園を中心にMapを表示
* Map上で位置を指定して、情報登録画面に遷移後に再びMapに戻った際に選択した位置を中心にMapを表示

この設定をするにあたり、ページ遷移をすると選択した位置情報が消えてしまうという課題に直面した。
試行錯誤した結果、セッションストレージへ最後に選択した位置情報を保存することで解決することができた。

### 【Map上でクリックした際のマーカーの挙動】
Map上でクリックをすると、クリックをした位置でマーカーを立てる設定をした。
GoogleMapAPIの公式ドキュメントに記載されている方法で設定をしたが、クリックする毎に新しいピンが立ち前のピンが残ってしまうという課題があった。
そこで、Vueのdata内にマーカーを保存する設定をして条件分岐によりdata内にマーカーがあれば削除をするという関数を追加することで解決することができた。

### 【herokuへのデプロイ】
herokuへデプロイする際に、ディレクトリの構成に課題があった。
1. djangoの仕様上、静的なファイルはstaticフォルダ内にまとめる必要がある
1. Vue.jsでbuildで生成したファイルをstaticフォルダ内に保存する必要がある
1. デプロイの際にNodejsとしてherokuに認識させるにはルートディレクトリにpackage.jsonを配置する必要がある
1. Vue.jsでstylesheetなどを読み込むパスの設定方法

上記の課題により、herokuへのデプロイがうまく出来ずに解決に1週間ほど費やしてしまったが以下の方法で解決することが出来た。

1. djangoの仕様上、静的なファイルはstaticフォルダ内にまとめる必要がある
2. Vue.jsでbuildで生成したファイルをstaticフォルダ内に保存する必要がある

=> STATICFILES_DIRSにVue.jsでbuildされる際に生成されるディレクトリを指定することで、静的ファイルをdjangoのstaticディレクトリに集約することができた。

3. デプロイの際にNodejsとしてherokuに認識させるにはルートディレクトリにpackage.jsonを配置する必要がある

=> ルートディレクトリ直下にpackage.jsonを配置する必要があるが、実際に配置しているディレクトリはフロントエンドのファイルを管理しているfrontendディレクトリ内のため読み込みができなかった。
   色々調べた結果、package.jsonのファイル内にLinuxコマンドを記載することできることを知った。
   具体的には、frontendディレクトリ内とは別にルートディレクトリ直下にpackage.jsonを配置。
   ファイル内に「cd frontend; npm install」「cd frontend; npm run build」と記載することで、herokuがpackage.jsonを読み込んだ際に実際に読み込んでほしいディレクトリへ移動し読み込みをさせることができた。

4. Vue.jsでstylesheetなどを読み込むパスの設定方法
=> デフォルトの設定だとデプロイができても、ブラウザで立ち上げた際に読み込むstylesheetが見つからず画面表示が出来なかった。そのためvue.config.js内のpublicPathを「/static/」、outputDirの設定を
  「./dist/static/」と変更をして、読み込むpathの設定などをdjangoの設定と合わせることで画面表示をすることができた。

以上の方法により、herokuへデプロイをする際の課題を解決することが出来た。